#!/bin/bash

# Script for installing initial development environment
# Only one argument is allowed: --os=macos (for the moment only macOS is supported)

# Print right emoji for OS, it accepts only one argument, the OS
# Example: print_os_emoji macos
print_os_emoji() {
    if [ "$1" == "macos" ]; then
        echo "ðŸŽ"
    fi
}

# Make sure --os= option is set ( e.g. --os=macos )
os_option=$(echo "$@" | grep -o "\-\-os=[a-z]*" | cut -d "=" -f 2)
if [ -z "$os_option" ]; then
    echo ""
    echo "ðŸš¨ãƒ»No --os= option set. Exiting..."
    echo ""
    exit 1
fi
echo ""
echo "ðŸ’»ãƒ»OS: $os_option $(print_os_emoji $os_option)"
echo ""

# Check if gum is installed
if ! command -v gum &> /dev/null
then
    echo "ðŸ¬ãƒ»Gum could not be found. Installing..."
    if [ "$os_option" == "macos" ]; then
        brew install gum
    fi
    echo ""
    echo "Done ðŸª‡"
    echo ""
else
    echo "ðŸ¬ãƒ»Gum is already installed. Skipping..."
    echo ""
    echo "Done ðŸª‡"
    echo ""
fi

# Create python virtual environment if it doesn't exist
if [ ! -d "venv" ]; then
    echo "ðŸãƒ»Python virtual environment does not exist. Creating..."
    gum spin --spinner monkey --title "Creating virtual environment" -- python3 -m venv venv
    echo ""
    echo "Done ðŸª‡"
    echo ""
else
    echo "ðŸãƒ»Python virtual environment already exists. Skipping..."
    echo ""
    echo "Done ðŸª‡"
    echo ""
fi

# Check if Make is installed
if ! command -v make &> /dev/null
then
    echo "ðŸ› ãƒ»Make could not be found. Installing..."
    if [ "$os_option" == "macos" ]; then
        gum spin --spinner monkey --title "Creating virtual environment" --brew install make
    fi
    echo ""
    echo "Done ðŸª‡"
    echo ""
else
    echo "ðŸ› ãƒ»Make is already installed. Skipping..."
    echo ""
    echo "Done ðŸª‡"
    echo ""
fi
